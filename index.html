<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VanaspatiSetu - Transparent Herbal Supply Chain</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
   

    <div class="grain-overlay"></div>

    <header>
      <div class="header-content">
        
      <nav class="navbar">
      <div class="logo">VanaspatiSetuüåø</div>
      <div class="nav-links">
        
        <a href="index.html">Home</a>
        <a href="index.html#verify">Verify</a>
        <a href="farmer.html">Farmer</a>
        <a href="qr_codes.html">QR</a>
        <a href="architecture.html">Architecture</a>
      </div>
    </nav>
    </header>

    <div class="container">
      <div class="hero">
        <h1>From Soil to Shelf</h1>
        <p>
          Every herb has a story. Verify the complete journey of your herbal
          products with blockchain-powered transparency.
        </p>
      </div>

      <div class="search-section" id="verify">
        <h2>Verify Your Product</h2>
        <div class="qr-input-group">
          <input
            type="text"
            class="qr-input"
            id="batchInput"
            placeholder="Enter Batch ID (e.g., ASHW_2026_001) or scan QR code"
          />
          <button class="btn btn-primary" onclick="verifyBatch()">
            Verify
          </button>
        </div>
        <p style="margin-bottom: 1rem; color: var(--earth-600)">
          Try our sample batches:
        </p>
        <div class="quick-samples">
          <button class="sample-btn" onclick="loadBatch('ASHW_2026_001')">
            Ashwagandha Capsules
          </button>
          <button class="sample-btn" onclick="loadBatch('TULSI_2026_042')">
            Tulsi Tea Blend
          </button>
          <button class="sample-btn" onclick="loadBatch('BRAHMI_2026_018')">
            Brahmi Extract
          </button>
        </div>
      </div>

      <div id="batchDetails" class="batch-details">
        <div class="batch-header">
          <div class="qr-display">üì±</div>
          <div class="batch-info">
            <h2 id="productName">Loading...</h2>
            <div class="batch-meta">
              <strong>Batch ID:</strong> <span id="batchId"></span> |
              <strong>Manufactured:</strong> <span id="mfgDate"></span>
            </div>
          </div>
          <div class="status-badge status-verified">‚úì Verified</div>
        </div>

        <div class="timeline">
          <h3>üå± Journey Timeline</h3>
          <div id="timelineContent"></div>
        </div>

        <div class="grid-2">
          <div class="card">
            <h3>üìç Origin Map</h3>
            <div id="map"></div>
            <div
              style="
                margin-top: 1rem;
                color: var(--earth-600);
                font-size: 0.9rem;
              "
            >
              <strong>Location:</strong> <span id="location"></span>
            </div>
          </div>

          <div class="card">
            <h3>üî¨ Lab Test Results</h3>
            <div id="testResults" class="test-results"></div>
          </div>
        </div>

        <div class="fair-trade">
          <h3>üí∞ Fair Trade & Sustainability</h3>
          <div class="payment-details" id="paymentDetails"></div>
        </div>
      </div>
    </div>

    <footer>
      <div class="footer-content">
        <p>
          <strong>VanaspatiSetu</strong> - Powered by Hyperledger Fabric Blockchain
        </p>
        <p>
          Ensuring transparency, quality, and fair practices in the herbal
          supply chain
        </p>
        <p style="font-size: 0.85rem; margin-top: 1.5rem">
          ¬© 2026 VanaspatiSetu Project. Built for transparency and trust.
        </p>
      </div>
    </footer>

    <script>
  let map;

  function verifyBatch() {
    const input = document
      .getElementById("batchInput")
      .value.trim()
      .toUpperCase();
    loadBatch(input);
  }

  function loadBatch(batchId) {
    if (!batchId) return;

    // 1Ô∏è‚É£ Check farmer batches
    const farmerBatches = JSON.parse(localStorage.getItem("batches")) || {};
    if (farmerBatches[batchId]) {
      renderFarmerBatch(farmerBatches[batchId]);
      return;
    }

    // 2Ô∏è‚É£ Check demo database
    if (batchDatabase[batchId]) {
      renderDemoBatch(batchDatabase[batchId]);
      return;
    }

    alert("‚ùå Batch ID not found: " + batchId);
  }

  function renderDemoBatch(batch) {
    document.getElementById("productName").textContent = batch.productName;
    document.getElementById("batchId").textContent = batch.batchId;
    document.getElementById("mfgDate").textContent = batch.mfgDate;
    document.getElementById("location").textContent = batch.location;

    document.getElementById("timelineContent").innerHTML = batch.timeline
      .map(
        (item) => `
        <div class="timeline-item">
          <div class="timeline-icon">${item.icon}</div>
          <div class="timeline-content">
            <h4>${item.title}</h4>
            <div class="timeline-date">${item.date}</div>
            <div class="timeline-details">
              ${Object.entries(item.details)
                .map(
                  ([k, v]) =>
                    `<div class="detail-row"><b>${k}:</b> ${v}</div>`,
                )
                .join("")}
            </div>
          </div>
        </div>
      `,
      )
      .join("");

    document.getElementById("testResults").innerHTML = batch.tests
      .map(
        (t) => `
        <div class="test-item ${t.status}">
          <div>
            <div class="test-name">${t.name}</div>
            <div style="font-size:0.8rem;">Threshold: ${t.threshold}</div>
          </div>
          <div style="text-align:right">
            <div class="test-value">${t.value}</div>
            <span class="test-status ${t.status}">${t.status.toUpperCase()}</span>
          </div>
        </div>
      `,
      )
      .join("");

    document.getElementById("paymentDetails").innerHTML = batch.payment
      .map(
        (p) => `
        <div class="payment-item">
          <div class="payment-value">${p.value}</div>
          <div class="payment-label">${p.label}</div>
        </div>
      `,
      )
      .join("");

    showBatch(batch.coords, batch.location);
  }

  function renderFarmerBatch(data) {
    document.getElementById("productName").textContent =
      data.herb.toUpperCase() + " Harvest Batch";

    document.getElementById("batchId").textContent = data.batchId;
    document.getElementById("mfgDate").textContent = new Date(
      data.harvestDate,
    ).toDateString();
    document.getElementById("location").textContent = data.location;

    document.getElementById("timelineContent").innerHTML = `
      <div class="timeline-item">
        <div class="timeline-icon">üåø</div>
        <div class="timeline-content">
          <h4>Harvested</h4>
          <div class="timeline-date">${new Date(
            data.harvestDate,
          ).toDateString()}</div>
          <div class="timeline-details">
            <div class="detail-row"><b>Herb:</b> ${data.herb}</div>
            <div class="detail-row"><b>Quantity:</b> ${data.quantity} kg</div>
            <div class="detail-row"><b>GPS:</b> ${data.gps.lat}, ${data.gps.lng}</div>
          </div>
        </div>
      </div>
    `;

    document.getElementById("testResults").innerHTML = `
      <div class="test-item pass">
        <div class="test-name">Initial Quality Check</div>
        <div class="test-value">Passed</div>
      </div>
    `;

    document.getElementById("paymentDetails").innerHTML = `
      <div class="payment-item">
        <div class="payment-value">‚Çπ${data.quantity * 270}</div>
        <div class="payment-label">Estimated Farmer Payment</div>
      </div>
    `;

    showBatch([data.gps.lat, data.gps.lng], data.location);
  }

  function showBatch(coords, locationName) {
    document.getElementById("batchDetails").style.display = "block";
    document
      .getElementById("batchDetails")
      .scrollIntoView({ behavior: "smooth" });

    setTimeout(() => initMap(coords, locationName), 200);
  }

  function initMap(coords, locationName) {
    if (map) map.remove();

    map = L.map("map").setView(coords, 10);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap contributors",
    }).addTo(map);

    L.marker(coords)
      .addTo(map)
      .bindPopup(`<b>${locationName}</b><br>Harvest Origin`)
      .openPopup();
  }

  // Auto load from QR
  window.addEventListener("load", () => {
    const params = new URLSearchParams(window.location.search);
    const batchId = params.get("batch");
    if (batchId) {
      document.getElementById("batchInput").value = batchId;
      loadBatch(batchId.toUpperCase());
    }
  });
</script>
  </body>
</html>
